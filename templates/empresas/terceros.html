<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Proveedor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../static/css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>


.icono-softsquare {
  width: 48px;
  height: 48px;
  border-radius: 12px;
  display: inline-block;
}
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <img src="../../static/media/logoLv.png" width="150" height="70" alt="logo linking value" />
            </div>
            <div class="sidebar-menu">
                <p class="menu-title">Navegación</p>
                <a href="#" class="menu-item active">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-file-alt"></i>
                    <span>Formularios</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-bell"></i>
                    <span>Notificaciones</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-cog"></i>
                    <span>Configuración</span>
                </a>

                <p class="menu-title">Empresa</p>
                <a href="#" class="menu-item">
                    <i class="fas fa-building"></i>
                    <span>Información</span>
                </a>
                <a href="#" class="menu-item">
                    <i class="fas fa-question-circle"></i>
                    <span>Soporte</span>
                </a>
                <a id="logoutBtn" class="menu-item"><i class="fas fa-sign-out-alt"></i><span>Cerrar sesión</span></a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h1>Dashboard de Proveedor</h1>
                <div class="user-profile">
                    <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User">
                    <div class="user-info">
                        <h4>Maria García</h4>
                        <p>Proveedor de Acme Corp</p>
                    </div>
                </div>
            </div>

            <!-- Welcome Banner -->
            <div class="welcome-banner">
                <div class="welcome-text">
                    <h2>Formularios de Cumplimiento</h2>
                    <p>Complete los formularios requeridos por su empresa cliente para mantener su relación comercial activa.</p>
                </div>
                <div>
                    <button class="btn btn-white">
                        <i class="fas fa-question-circle"></i> Ayuda
                    </button>
                </div>
            </div>

            <div id="noFormMsg" style="display:none; text-align:center; margin-top:2rem;">
                    <p>Todavía no tiene su formulario disponible.</p>
            </div>

            <!-- Topics Grid -->
            <div class="topics-container">
                <!-- Información General -->
                <div class="topic-card general" style="display:none;">
                    <span class="status-badge">Pendiente</span>
                    <div class="topic-header">
                        <div class="topic-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="topic-info">
                            <h3>Información General</h3>
                            <p>Datos básicos de su empresa</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progreso</span>
                            <span>25%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 25%;"></div>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button onclick="traerFormulario('informacion general', this)" class="btn btn-primary">
                            <i class="fas fa-edit"></i> Completar
                        </button>
                    </div>
                </div>

                <!-- Anticorrupción -->
                <div class="topic-card anticorruption" style="display:none;">
                    <span class="status-badge">En progreso</span>
                    <div class="topic-header">
                        <div class="topic-icon">
                             <img src="../../static/icons/ico-anticorrupcion.svg"
     alt="Icono Anticorrupción"
     class="icono-softsquare icono-anticorrupcion">
                        </div>
                        <div class="topic-info">
                            <h3>Anticorrupción</h3>
                            <p>Políticas contra sobornos</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progreso</span>
                            <span>65%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 65%;"></div>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button onclick="traerFormulario('anticorrupcion', this)" class="btn btn-primary">
                            <i class="fas fa-edit"></i> Continuar
                        </button>
                    </div>
                </div>

                <!-- Derechos Humanos -->
                <div class="topic-card humanrights" style="display:none;">
                    <span class="status-badge">No iniciado</span>
                    <div class="topic-header">
                        <div class="topic-icon">
                            <img src="../../static/icons/ico-derechoshumanos.svg"
     alt="Icono Derechos Humanos"
     class="icono-softsquare icono-derechoshumanos">
                        </div>
                        <div class="topic-info">
                            <h3>Derechos<br> Humanos</h3>
                            <p>Políticas de derechos <br> laborales</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progreso</span>
                            <span>0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 0%;"></div>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button onclick="traerFormulario('derechos humanos', this)" class="btn btn-primary">
                            <i class="fas fa-play"></i> Iniciar
                        </button>
                    </div>
                </div>

                <!-- Estándares Laborales -->
                <div class="topic-card labor" style="display:none;">
                    <span class="status-badge">Completado</span>
                    <div class="topic-header">
                        <div class="topic-icon">
                             <img src="../../static/icons/ico-estandareslaborales.svg"
     alt="Icono Estandares Laborales"
     class="icono-softsquare icono-estandares">
                        </div>
                        <div class="topic-info">
                            <h3>Estándares<br> Laborales</h3>
                            <p>Condiciones de trabajo</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progreso</span>
                            <span>100%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%;"></div>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button onclick="traerFormulario('estandares laborales', this)" class="btn btn-primary">
                            <i class="fas fa-eye"></i> Ver
                        </button>
                    </div>
                </div>

                <!-- Medio Ambiente -->
                <div class="topic-card environment" style="display:none;">
                    <span class="status-badge">Pendiente</span>
                    <div class="topic-header">
                        <div class="topic-icon">
                             <img src="../../static/icons/ico-medioambiente.svg"
                                alt="Icono Medio Ambiente"
                                class="icono-softsquare icono-medioambiente">
                        </div>
                        <div class="topic-info">
                            <h3>Medio Ambiente</h3>
                            <p>Prácticas sostenibles</p>
                        </div>
                    </div>
                    <div class="progress-container">
                        <div class="progress-label">
                            <span>Progreso</span>
                            <span>15%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 15%;"></div>
                        </div>
                    </div>
                    <div class="topic-actions">
                        <button onclick="traerFormulario('medio ambiente', this)" class="btn btn-primary">
                            <i class="fas fa-edit"></i> Completar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
            document.addEventListener("DOMContentLoaded", async () => {


      // Verifica si el usuario tiene acceso
    function verificarAcceso() {
      const usuario = localStorage.getItem("usuarioLogueado");
      if (!usuario || usuario!='tercero') {
        alert("No tienes acceso. Iniciá sesión.");
        window.location.href = "../../index.html";
      }
    }

    verificarAcceso(); // ejecutar al inicio de cada página privada


     const data = localStorage.getItem("infoTercero");
    if (data) {
        const infoTercero = JSON.parse(data);
        console.log("Info del tercero:", infoTercero);
        const categorias = infoTercero?.categorias || [];


        const cards = document.querySelectorAll(".topic-card");
        let algunaVisible = false;


        if (categorias.length === 0) {
            document.getElementById("noFormMsg").style.display = "block";
            return;
        }

        categorias.forEach(cat => {
            let className = "";
            switch (cat.toLowerCase()) {
            case "informacion general":
                className = "general";
                break;
            case "anticorrupcion":
                className = "anticorruption";
                break;
            case "derechos humanos":
                className = "humanrights";
                break;
            case "estandares laborales":
                className = "labor";
                break;
            case "medio ambiente":
                className = "environment";
                break;
            }
            
            const card = document.querySelector(`.topic-card.${className}`);
            if (card) {
            card.style.display = "block";
            algunaVisible = true;
            }
        });

        if (!algunaVisible) {
            document.getElementById("noFormMsg").style.display = "block";
        }
    } else {
        console.warn("No se encontró info del tercero en localStorage");
    }


})


        document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.clear();
      window.location.href = '../../index.html';
    });


        function traerFormulario(categoria, buttonElement) {
        const info = JSON.parse(localStorage.getItem("infoTercero"));

        if (!info || !info.tercero || !info.tercero.formulario_id) {
            console.error("No se encontró la info del tercero o el ID del formulario.");
            return;
        }

        const formularioId = info.tercero.formulario_id;

        fetch(`http://localhost:8000/formularios/${formularioId}/categoria/${categoria}`)
            .then(res => res.json())
            .then(data => {

            if (!data || data.length === 0) {
                console.warn("No hay preguntas en el formulario");
                return;
            }

            // Obtener color de borde top (puede estar en el contenedor topic-card)
            const card = buttonElement.closest(".topic-card");
            const borderTop = getComputedStyle(card).borderTopColor;

            // Guardar en SessionStorage
            localStorage.setItem('preguntas_categoria', JSON.stringify(data));
            sessionStorage.setItem('categoria_actual', categoria);
            sessionStorage.setItem('color_categoria', borderTop);

            window.location.href = 'formularios_terceros.html';
            })
            .catch(err => {
            console.error("Error al traer el formulario:", err);
            });
        }



    </script>
</body>
</html>